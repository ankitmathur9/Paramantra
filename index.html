<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paramantra Script Generator - Microsoft Enhanced</title>
  <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f3f4f6; margin:0; }
    .container { max-width: 800px; margin: 2rem auto; background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .header { text-align: center; margin-bottom: 2rem; }
    .logo { font-size: 1.8rem; font-weight: bold; color: #2563eb; }
    .btn { background: #2563eb; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 1rem; cursor: pointer; }
    .btn:hover { background: #1d4ed8; }
    .error { background: #fee2e2; color: #b91c1c; padding: 1rem; border-radius: 6px; margin-top: 1rem; display:none; }
    .user-info { background: #f3f4f6; padding: 1rem; border-radius: 6px; margin-bottom: 1rem; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">Paramantra Script Generator</div>
      <p>AI-Powered with Microsoft Integration</p>
    </div>

    <!-- Login Section -->
    <div id="loginSection">
      <button id="loginBtn" class="btn">Sign In with Microsoft</button>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display:none;">
      <div class="user-info">
        <strong>Welcome, <span id="userName"></span></strong><br>
        <small id="userEmail"></small>
        <button id="logoutBtn" class="btn" style="background:#dc2626; float:right;">Sign Out</button>
      </div>
      <p>âœ… Microsoft Authentication Successful</p>
    </div>

    <!-- Error Box -->
    <div id="errorMessage" class="error"></div>
  </div>

  <script>
    // MSAL Config
    const msalConfig = {
      auth: {
        clientId: "e9739aed-38bc-4937-a166-df136fa59c5c",
        authority: "https://login.microsoftonline.com/847b3797-657d-4cf9-8583-5ca191fabede",
        redirectUri: "https://ankitmathur9.github.io/Paramantra/" // must match Azure AD registration
      },
      cache: {
        cacheLocation: "sessionStorage",
        storeAuthStateInCookie: false
      }
    };

    const loginRequest = { scopes: ["User.Read"] };
    const msalInstance = new msal.PublicClientApplication(msalConfig);

    // Handle redirect response
    msalInstance.handleRedirectPromise().then((response) => {
      if (response !== null) {
        msalInstance.setActiveAccount(response.account);
        showMainApp(response.account);
      } else {
        const currentAccounts = msalInstance.getAllAccounts();
        if (currentAccounts.length > 0) {
          msalInstance.setActiveAccount(currentAccounts[0]);
          showMainApp(currentAccounts[0]);
        }
      }
    }).catch((error) => {
      showError(error.message);
    });

    // Functions
    function signIn() {
      msalInstance.loginRedirect(loginRequest);
    }

    function signOut() {
      const account = msalInstance.getActiveAccount();
      if (account) {
        msalInstance.logoutRedirect({ account });
      }
    }

    function showMainApp(account) {
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("mainApp").style.display = "block";
      document.getElementById("userName").textContent = account.name || "User";
      document.getElementById("userEmail").textContent = account.username || "";
    }

    function showError(message) {
      const el = document.getElementById("errorMessage");
      el.textContent = "Error: " + message;
      el.style.display = "block";
    }

    // Event Listeners
    document.getElementById("loginBtn").addEventListener("click", signIn);
    document.getElementById("logoutBtn").addEventListener("click", signOut);
  </script>
</body>
</html>
